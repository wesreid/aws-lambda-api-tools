#!/usr/bin/env node
"use strict";var s=require("commander"),a=require("path");s.program.name("aws-lambda-api-tools").description("CLI tools for AWS Lambda and API Gateway").version("0.1.5");s.program.command("create-gha-iam-stack").description("Create IAM stack for GitHub Actions OIDC authentication").option("--repo <owner/repo>","GitHub repository to add (owner/repo)",t,[]).option("--remove-repo <owner/repo>","GitHub repository to remove (owner/repo)",n,[]).option("--policy <name>","AWS managed policy name","AdministratorAccess").option("--mode <mode>","Operation mode: merge (add new repos), replace (overwrite all), list (show current repos)","replace").option("--yes","Skip confirmation prompt",!1).option("--stack-name <name>","CloudFormation stack name","GithubActionsIam").option("--role-name <name>","IAM role name","GithubActionsRole").option("--max-session-duration <seconds>","Max session duration in seconds (default: 3600, max: 43200)","3600").action(async e=>{let r=process.argv[0]??"node",m=process.argv[1]??"";if(e.mode==="list"){process.argv=[r,m,"--mode=list",`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`],require((0,a.join)(__dirname,"bootstrap-iam.js"));return}if(e.repo.length>0&&e.removeRepo.length>0){process.argv=[r,m,...e.repo.map(o=>`--repo=${o}`),...e.removeRepo.map(o=>`--remove-repo=${o}`),`--policy=${e.policy}`,"--mode=mixed",`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`,`--max-session-duration=${e.maxSessionDuration}`,...e.yes?["--yes"]:[]],require((0,a.join)(__dirname,"bootstrap-iam.js"));return}if(e.removeRepo.length>0){process.argv=[r,m,...e.removeRepo.map(o=>`--remove-repo=${o}`),`--policy=${e.policy}`,"--mode=remove",`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`,`--max-session-duration=${e.maxSessionDuration}`,...e.yes?["--yes"]:[]],require((0,a.join)(__dirname,"bootstrap-iam.js"));return}e.repo.length===0&&(console.error("Error: at least one --repo argument is required (or use --mode=list to view current repos)"),process.exit(1)),["merge","replace"].includes(e.mode)||(console.error("Error: --mode must be one of: merge, replace, list"),process.exit(1)),process.argv=[r,m,...e.repo.map(o=>`--repo=${o}`),`--policy=${e.policy}`,`--mode=${e.mode}`,`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`,`--max-session-duration=${e.maxSessionDuration}`,...e.yes?["--yes"]:[]],require((0,a.join)(__dirname,"bootstrap-iam.js"))});function t(e,r){return r.concat([e])}function n(e,r){return r.concat([e])}s.program.parse();
