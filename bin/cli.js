#!/usr/bin/env node
"use strict";var a=require("commander"),o=require("path");a.program.name("aws-lambda-api-tools").description("CLI tools for AWS Lambda and API Gateway").version("0.1.5");a.program.command("create-gha-iam-stack").description("Create IAM stack for GitHub Actions OIDC authentication").option("--repo <owner/repo>","GitHub repository to add (owner/repo)",m,[]).option("--remove-repo <owner/repo>","GitHub repository to remove (owner/repo)",s,[]).option("--policy <name>","AWS managed policy name","AdministratorAccess").option("--mode <mode>","Operation mode: merge (add new repos), replace (overwrite all), list (show current repos)","replace").option("--yes","Skip confirmation prompt",!1).option("--stack-name <name>","CloudFormation stack name","GithubActionsIam").option("--role-name <name>","IAM role name","GithubActionsRole").action(async e=>{if(e.mode==="list"){process.argv=[process.argv[0],process.argv[1],"--mode=list",`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`],require((0,o.join)(__dirname,"bootstrap-iam.js"));return}if(e.repo.length>0&&e.removeRepo.length>0){process.argv=[process.argv[0],process.argv[1],...e.repo.map(r=>`--repo=${r}`),...e.removeRepo.map(r=>`--remove-repo=${r}`),`--policy=${e.policy}`,"--mode=mixed",`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`,...e.yes?["--yes"]:[]],require((0,o.join)(__dirname,"bootstrap-iam.js"));return}if(e.removeRepo.length>0){process.argv=[process.argv[0],process.argv[1],...e.removeRepo.map(r=>`--remove-repo=${r}`),`--policy=${e.policy}`,"--mode=remove",`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`,...e.yes?["--yes"]:[]],require((0,o.join)(__dirname,"bootstrap-iam.js"));return}e.repo.length===0&&(console.error("Error: at least one --repo argument is required (or use --mode=list to view current repos)"),process.exit(1)),["merge","replace"].includes(e.mode)||(console.error("Error: --mode must be one of: merge, replace, list"),process.exit(1)),process.argv=[process.argv[0],process.argv[1],...e.repo.map(r=>`--repo=${r}`),`--policy=${e.policy}`,`--mode=${e.mode}`,`--stack-name=${e.stackName}`,`--role-name=${e.roleName}`,...e.yes?["--yes"]:[]],require((0,o.join)(__dirname,"bootstrap-iam.js"))});function m(e,r){return r.concat([e])}function s(e,r){return r.concat([e])}a.program.parse();
